<?xml version="1.0"?>
<project default="all" basedir="../../../.."
  xmlns:au="antlib:org.apache.ant.antunit"
  xmlns:deb="antlib:org.apache.ant.debian">

  <property name="ant.src.dir" value="${basedir}/ant-core-trunk"/>
  <property name="package" value="${ant.src.dir}/ant_1.7.1_all.deb"/>
  <property name="controlfile" value="${ant.src.dir}/dist/DEBIAN/control"/>

  <target name="tearDown">
    <delete file="${controlfile}"/>
    <delete file="${package}"/>
  	<delete dir="${ant.src.dir}/dist/DEBIAN"/>
  </target>

  <target name="setUp">
  	<mkdir dir="${ant.src.dir}/dist/DEBIAN"/>
  	<au:assertFileExists file="${ant.src.dir}/dist/DEBIAN"/>
    <au:assertFileDoesntExist file="${controlfile}"/>
  	<deb:control file="${controlfile}" 
  	  package="ant" version="1.7.1alpha" maintainer="kevj@apache.org"
  	  essential="no" priority="optional" section="Development" architecture="all"
  	  homepage="http://ant.apache.org">
      <depends>java-gcj-compat | java-virtual-machine</depends>
      <depends>java-gcj-compat | java1-runtime | java2-runtime</depends>
  	  <depends>libxerces2-java</depends>
  	  <recommends>ant-optional</recommends>
  	  <recommends>jikes | java-compiler</recommends>
  	  <suggests>ant-doc</suggests>
  	  <conflicts>ant(&lt;=1.6.5-6)</conflicts>
  	  <conflicts>ant-doc(&lt;=1.6.5-6)</conflicts>
  	  <replaces>ant(&lt;=1.6.5-6)</replaces>
  	  <replaces>ant-doc(&lt;=1.6.5-6)</replaces>
  	  <description>Java based build tool like make</description>
  	</deb:control>
    <au:assertFileExists file="${controlfile}"/>
  </target>

  <target name="test-build">
  	<echo message="${ant.src.dir}"/>
    <au:assertFileDoesntExist file="${package}"/>
    <deb:dpkg packageName="${package}" dir="${ant.src.dir}/dist"/>
    <au:assertFileExists file="${package}"/>
  </target>

  <target name="all">
    <au:antunit>
      <fileset file="${ant.file}"/>
      <au:plainlistener/>
    </au:antunit>
  </target>
</project>